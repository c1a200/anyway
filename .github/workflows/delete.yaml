name: Delete

# 定义触发事件，包括定时触发和手动触发
on:
  schedule:
    # 定时触发，设置为每周日的午夜
    - cron: "0 0 * * SUN"
  workflow_dispatch: # 手动触发

jobs:
  del_runs:
    runs-on: ubuntu-latest
    env:
      # 定义环境变量，分别用于自动和手动触发情况下的保留天数
      RETAIN_DAYS_AUTO: 7
      RETAIN_DAYS_MANUAL: 0 # 手动触发时，删除所有数据
    steps:
      - name: Set retention days for manual trigger
        if: github.event_name == 'workflow_dispatch'
        run: echo "RETAIN_DAYS=${{ env.RETAIN_DAYS_MANUAL }}" >> $GITHUB_ENV

      - name: Set retention days for scheduled trigger
        if: github.event_name == 'schedule'
        run: echo "RETAIN_DAYS=${{ env.RETAIN_DAYS_AUTO }}" >> $GITHUB_ENV

      - name: Delete
        uses: GitRML/delete-workflow-runs@main
        with:
          token: ${{ secrets.GIST_PAT }} # 使用存储在 secrets 中的 Personal Access Token
          repository: ${{ github.repository }} # 当前仓库的名称
          retain_days: ${{ env.RETAIN_DAYS }} # 动态保留天数，根据触发类型不同而不同
